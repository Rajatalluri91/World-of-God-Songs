<!DOCTYPE html>
<html lang="te">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title>World of God - Raja Talluri</title>
    <link crossorigin="anonymous" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Mandali&display=swap" rel="stylesheet"/>
    <style>
        :root {
            --accent: #ffe98a;
            --bg-dark: #000000;
            --glass: rgba(255, 255, 255, 0.08);
            --text-main: #ffffff;
            --text-dim: #b3b3b3;
            --nav-bg: #0a0a0a;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        body { margin: 0; background: #000; color: var(--text-main); font-family: 'Mandali', sans-serif; height: 100vh; overflow: hidden; }

        /* టైటిల్ కోసం కొత్త ఫిక్సెడ్ స్టైల్స్ */
   .app-header {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        background: #000;
        z-index: 2500;
        padding: 5px 15px; /* ప్యాడింగ్ కొంచెం తగ్గించాను */
        border-bottom: 1px solid rgba(255,255,255,0.05);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .header-logo {
        height: 45px; /* లోగో సైజు ఇక్కడ అడ్జస్ట్ చేసుకోవచ్చు */
        width: auto;
        object-fit: contain;
    }
    /* బాడీ గ్యాప్ సర్దుబాటు */
    .main-content { 
        height: calc(100vh - 135px); 
        overflow-y: auto; 
        padding: 65px 15px 20px; /* టాప్ ప్యాడింగ్ హెడర్ కోసం ఇచ్చాను */
        display: none; 
        scroll-behavior: smooth; 
    }
    .main-content.active { display: block; }
    
    /* టైటిల్ గ్యాప్ తగ్గించడం */
    .gold-text { 
        background: linear-gradient(90deg, #d4af37, #f8e7a1, #c5a100); 
        -webkit-background-clip: text; 
        -webkit-text-fill-color: transparent; 
        font-weight: bold; 
        font-size: 22px; 
        margin: 0; 
    }
        .horizontal-scroll { display: flex; overflow-x: auto; gap: 15px; padding: 10px 5px; scrollbar-width: none; }
        .horizontal-scroll::-webkit-scrollbar { display: none; }

        .category-card { flex: 0 0 140px; background: var(--glass); border-radius: 15px; overflow: hidden; text-align: center; padding-bottom: 10px; border: 1px solid rgba(255,255,255,0.05); cursor: pointer; transition: 0.3s; }
        .category-card img { width: 100%; aspect-ratio: 1/1; object-fit: cover; background: #222; }
        .category-card span { display: block; margin-top: 8px; font-size: 13px; color: var(--accent); padding: 0 5px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

        .track-item { display: flex; align-items: center; padding: 12px; margin-bottom: 10px; background: var(--glass); border-radius: 12px; border: 1px solid transparent; cursor: pointer; transition: 0.3s; }
        .track-item.active-song { border: 1px solid var(--accent); background: rgba(255, 233, 138, 0.15); }
        .track-item.active-song div { color: var(--accent); font-weight: bold; }

        .player-ctn { position: fixed; bottom: 70px; left: 0; width: 100%; background: #111; border-top: 1px solid rgba(255,255,255,0.1); transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); z-index: 3000; height: 65px; cursor: pointer; }
        .player-ctn.expanded { height: 100vh; bottom: 0; background: #000; cursor: default; }
        
        .mini-player-content { display: flex; align-items: center; padding: 10px; height: 65px; width: 100%; }
        .player-ctn.expanded .mini-player-content { display: none; }

        .expanded-view { display: none; flex-direction: column; height: 100%; padding: 40px 25px 30px; justify-content: space-between; }
        .player-ctn.expanded .expanded-view { display: flex; }

        .mini-art { width: 45px; height: 45px; border-radius: 8px; background-size: cover; background-position: center; }
        .big-art-container { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; width: 100%; position: relative; }
        .big-art { width: 85vw; max-width: 320px; aspect-ratio: 1/1; border-radius: 20px; background-size: cover; background-position: center; box-shadow: 0 20px 60px rgba(0,0,0,0.8); transition: 0.3s; }

        .lyrics-area { display: none; width: 100%; height: 350px; overflow-y: auto; text-align: center; color: var(--accent); mask-image: linear-gradient(to bottom, transparent, black 20%, black 80%, transparent); }
        .show-lyrics .big-art { display: none; }
        .show-lyrics .lyrics-area { display: block; }
        .lyric-line { opacity: 0.3; margin: 20px 0; transition: 0.3s; font-size: 1.3rem; line-height: 1.6; }
        .lyric-line.active { opacity: 1; transform: scale(1.1); font-weight: bold; }

        #myProgress { width: 100%; height: 6px; background: rgba(255,255,255,0.1); border-radius: 10px; margin: 25px 0; cursor: pointer; }
        #myBar { height: 100%; background: var(--accent); width: 0%; border-radius: 10px; }
        .play-pause-circle { width: 70px; height: 70px; background: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #000; font-size: 28px; }

        .bottom-nav { position: fixed; bottom: 0; width: 100%; height: 70px; background: var(--nav-bg); display: flex; justify-content: space-around; align-items: center; border-top: 1px solid rgba(255,255,255,0.1); z-index: 2000; }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: var(--text-dim); font-size: 11px; opacity: 0.7; cursor: pointer; }
        .nav-item.active { color: var(--accent); opacity: 1; }
        .nav-item i { font-size: 22px; margin-bottom: 4px; }
        .playlist-ctn { padding-bottom: 20px; }
        
    </style>
</head>
<body>

<div class="app-header">
    <h2 class="gold-text">World of God</h2>
    <img src="https://raw.githubusercontent.com/Rajatalluri91/World-of-God-Songs/refs/heads/main/icons/icon-512.png" alt="Logo" class="header-logo">
</div>


<div id="home-sec" class="main-content active">
    <div class="section-header"><h3>Album Songs</h3></div>
    <div class="horizontal-scroll">
        <div class="category-card" onclick="loadPlaylist('devotional')">
            <img src="https://github.com/Rajatalluri91/WOG-Images/blob/main/Songs%20Cover.gif?raw=true">
            <span>Devuni Prapancham</span>
        </div>
        <div class="category-card" onclick="loadPlaylist('newyear')">
            <img src="https://github.com/Rajatalluri91/WOG-Images/blob/main/Children%20Songs.gif?raw=true">
            <span>Children Songs</span>
        </div>
    </div>
    <div class="playlist-ctn"></div>
</div>




<div id="bible-sec" class="main-content">
   
    <div class="section-header"><h3>Bible Study</h3></div>
    <div class="horizontal-scroll">
        <div class="category-card" onclick="window.open('https://worldofgod79-del.github.io/New-bible/', '_self')">
            <img src="https://github.com/Rajatalluri91/WOG-Images/blob/main/Telugu%20Bible.gif?raw=true">
            <span>Telugu Bible</span>
        </div>
        <div class="category-card" onclick="window.location.href='https://rajatalluri91.github.io/World-of-God-Songs/Available%20Soon.html'">
            <img src="https://raw.githubusercontent.com/Rajatalluri91/WOG-Images/refs/heads/main/Bible%20Books.gif">
            <span>Bible Books Overview</span>
        </div>
    </div>
</div>

<div id="video-sec" class="main-content">
   
    <div class="section-header"><h3>Videos Section</h3></div>
    <div class="horizontal-scroll">
        <div class="category-card" onclick="window.location.href='https://rajatalluri91.github.io/WOG-Youtube/'">
            <img src="https://raw.githubusercontent.com/Rajatalluri91/WOG-Images/refs/heads/main/Video%20Songs.jpg">
            <span>Video Songs</span>
        </div>
        <div class="category-card"
     onclick="window.location.href='https://rajatalluri91.github.io/World-of-God-Songs/Available%20Soon.html'">
    <img src="https://raw.githubusercontent.com/Rajatalluri91/WOG-Images/refs/heads/main/Short%20Videos.png">
    <span>Short Videos</span>    
</div>
    </div>
</div>

<div id="messages-sec" class="main-content">
    <div class="section-header"><h3>Audio Messages</h3></div>
    <div class="horizontal-scroll">
        <div class="category-card" onclick="loadPlaylist('sermons')">
            <img src="https://raw.githubusercontent.com/Rajatalluri91/WOG-Images/refs/heads/main/Podcast.gif">
            <span>Podcast</span>
        </div>
        
        <div class="category-card" onclick="loadPlaylist('classes')">
            <img src="https://raw.githubusercontent.com/Rajatalluri91/WOG-Images/refs/heads/main/Bible%20Lessons.jpg">
            <span>Recorded Classes</span>
        </div>
    </div>
    <div class="playlist-ctn"></div>
</div>

<div id="docs-sec" class="main-content">
    
    <div class="section-header"><h3>Library</h3></div>
    <div class="horizontal-scroll">
        <div class="category-card" onclick="loadDocList('bibleDocs')">
            <img src="https://github.com/Rajatalluri91/WOG-Images/blob/main/Bible%20Lessons.gif?raw=true">
            <span>Bible Lessons</span>
        </div>
        <div class="category-card" onclick="loadDocList('articles')">
            <img src="https://github.com/Rajatalluri91/WOG-Images/blob/main/Bible%20Articles.gif?raw=true">
            <span>Articles</span>
        </div>
    </div>
    <div class="playlist-ctn" id="docs-list-ctn"></div>
</div>


<div class="player-ctn" id="mainPlayer" onclick="handleMiniPlayerClick(event)">
    <div class="mini-player-content">
        <div class="mini-art" id="miniArt" onclick="toggleExpand(event)"></div>
        <div style="flex-grow:1; margin-left:12px; overflow:hidden;" onclick="toggleExpand(event)">
            <div id="mini-title" style="font-size:14px; font-weight:bold; white-space:nowrap; text-overflow:ellipsis;">పాటను ఎంచుకోండి</div>
            <div id="mini-timer" style="font-size:11px; color:var(--accent);">00:00</div>
        </div>
        <div style="padding: 0 15px;">
             <i class="fas fa-play" id="m-play" onclick="toggleAudio(event)"></i>
             <i class="fas fa-pause" id="m-pause" style="display:none" onclick="toggleAudio(event)"></i>
        </div>
    </div>

    <div class="expanded-view">
        <div style="display:flex; justify-content: space-between; align-items: center; width:100%;" onclick="closePlayer(event)">
            <i class="fas fa-chevron-down" style="color:var(--accent); font-size:24px;"></i>
            <span style="font-size:12px; opacity:0.6; letter-spacing: 2px;">NOW PLAYING</span>
            <i class="fas fa-ellipsis-v" style="opacity:0"></i>
        </div>
        <div class="big-art-container" id="artBox" onclick="toggleLyrics(event)">
            <div class="big-art" id="exp-art"></div>
            <div class="lyrics-area" id="lyricsText"></div>
            <p id="tap-hint" style="text-align:center; font-size:12px; margin-top:10px; opacity:0.5;">Tap for Lyrics</p>
        </div>
        <div style="width:100%;">
            <h2 id="exp-title" style="color:var(--accent); margin:0; text-align:center; font-size:20px;">Song Title</h2>
            <div id="myProgress" onclick="seek(event)"><div id="myBar"></div></div>
            <div style="display:flex; justify-content:space-between; font-size:12px; color:var(--text-dim); margin-top:-15px;">
                <span id="currTime">00:00</span>
                <span id="totalTime">00:00</span>
            </div>
            <div style="display:flex; justify-content:space-around; align-items:center; margin-top:20px;">
                <div class="speed-tag" onclick="changeSpeed(event)" id="speedBtn" style="color:var(--accent)">1x</div>
                <i class="fas fa-step-backward" onclick="previous(event)" style="font-size:25px;"></i>
                <div class="play-pause-circle" onclick="toggleAudio(event)">
                    <i class="fas fa-play" id="e-play"></i><i class="fas fa-pause" id="e-pause" style="display:none"></i>
                </div>
                <i class="fas fa-step-forward" onclick="next(event)" style="font-size:25px;"></i>
                <i class="fas fa-download" onclick="downloadSong(event)" style="font-size:20px;"></i>
            </div>
        </div>
    </div>
</div>

<nav class="bottom-nav">
    <div class="nav-item active" onclick="showSection('home-sec', this)"><i class="fas fa-home"></i>Home</div>
    <div class="nav-item" onclick="showSection('bible-sec', this)"><i class="fas fa-book"></i>Bible</div>
    <div class="nav-item" onclick="showSection('messages-sec', this)"><i class="fas fa-microphone"></i>Messages</div>
    <div class="nav-item" onclick="showSection('video-sec', this)"><i class="fas fa-play-circle"></i>Videos</div>
    <div class="nav-item" onclick="showSection('docs-sec', this)"><i class="fas fa-file-alt"></i>Docs</div>
</nav>

<audio id="myAudio"></audio>

<script>
const audioData = {
    devotional: [
        { name:"సృష్టిలో విలువైనది స్నేహమే", file:"https://raw.githubusercontent.com/Rajatalluri91/World-of-God-Songs/main/Devuni%20Sneham.mp3", duration:"04:18", art:"https://github.com/Rajatalluri91/WOG-Images/blob/main/Songs%20Cover.jpg?raw=true", lrc:"https://raw.githubusercontent.com/Rajatalluri91/World-of-God-Songs/refs/heads/main/Lyrics/Devuni%20Sneham%20.lrc" },
        { name:"తుదివరకు నిలుచుటయే", file:"https://raw.githubusercontent.com/Rajatalluri91/World-of-God-Songs/main/Thudivaraku.mp3", duration:"05:13", art:"https://github.com/Rajatalluri91/WOG-Images/blob/main/Songs%20Cover.jpg?raw=true", lrc:"https://raw.githubusercontent.com/Rajatalluri91/World-of-God-Songs/refs/heads/main/Lyrics/Thudivaraku.lrc" },
        {
      name:"పండుగ చేద్దామా",
      file:"https://raw.githubusercontent.com/Rajatalluri91/World-of-God-Songs/main/Panduga.mp3",
      duration:"06:00",      art:"https://github.com/Rajatalluri91/WOG-Images/blob/main/Songs%20Cover.jpg?raw=true",
      lrc: "https://gist.githubusercontent.com/Rajatalluri91/69526796a0a48e6ab3c3fa74ff9ff5ae/raw/535674db84a6809da89b8b3c3ade05a1e5772588/3.%2520Panduga%2520Cheddama "
    },
    {
      name:"నీకై నూతనమవుతున్నది ",
      file:"https://raw.githubusercontent.com/Rajatalluri91/World-of-God-Songs/main/New%20Year%20Song.mp3",
      duration:"05:09",
      art:"https://github.com/Rajatalluri91/WOG-Images/blob/main/Songs%20Cover.jpg?raw=true",
      lrc: "https://gist.githubusercontent.com/Rajatalluri91/69526796a0a48e6ab3c3fa74ff9ff5ae/raw/535674db84a6809da89b8b3c3ade05a1e5772588/4.%2520Neekai%2520Nuthana "
    },
	{
      name:"ఆకాశంతో చెప్పనా",
      file:"https://raw.githubusercontent.com/Rajatalluri91/World-of-God-Songs/main/Akashamtho.mp3",
      duration:"04:11",
     art:"https://github.com/Rajatalluri91/WOG-Images/blob/main/Songs%20Cover.jpg?raw=true", 
      lrc: "https://gist.githubusercontent.com/Rajatalluri91/69526796a0a48e6ab3c3fa74ff9ff5ae/raw/535674db84a6809da89b8b3c3ade05a1e5772588/5.%2520Akashamtho "
    },
    {
      name:"తెలుసా ఇది తెలుసా",
      file:"https://raw.githubusercontent.com/Rajatalluri91/World-of-God-Songs/main/Telusa.mp3",
      duration:"04:21",
      art:"https://github.com/Rajatalluri91/WOG-Images/blob/main/Songs%20Cover.jpg?raw=true",
      lrc: "https://gist.githubusercontent.com/Rajatalluri91/69526796a0a48e6ab3c3fa74ff9ff5ae/raw/535674db84a6809da89b8b3c3ade05a1e5772588/6.%2520Telusa%2520Idhi%2520Telusa "
    },
    {
      name:"పండుగ చేద్దామా Track",
      file:"https://raw.githubusercontent.com/Rajatalluri91/World-of-God-Songs/main/Raja%27s%20Christmas%20Song%20%20Track.mp3",
      duration:"06:00",
      art:"https://github.com/Rajatalluri91/WOG-Images/blob/main/Songs%20Cover.jpg?raw=true",
      lrc: "https://gist.githubusercontent.com/Rajatalluri91/69526796a0a48e6ab3c3fa74ff9ff5ae/raw/535674db84a6809da89b8b3c3ade05a1e5772588/3.%2520Panduga%2520Cheddama "
    },
    {
      name:"New Year Song Track ",
      file:"https://raw.githubusercontent.com/Rajatalluri91/World-of-God-Songs/main/New%20Year%20Track.mp3",
      duration:"05:09",
     art:"https://github.com/Rajatalluri91/WOG-Images/blob/main/Songs%20Cover.jpg?raw=true", 
      lrc: "https://gist.githubusercontent.com/Rajatalluri91/69526796a0a48e6ab3c3fa74ff9ff5ae/raw/535674db84a6809da89b8b3c3ade05a1e5772588/4.%2520Neekai%2520Nuthana "
    },
    {
      name:"New Year Song Special ",
      file:"https://raw.githubusercontent.com/Rajatalluri91/World-of-God-Songs/main/New%20Year%20Song%20Remix.mp3",
      duration:"06:47",
      art:"https://github.com/Rajatalluri91/WOG-Images/blob/main/Songs%20Cover.jpg?raw=true",
      lrc: "https://gist.githubusercontent.com/Rajatalluri91/69526796a0a48e6ab3c3fa74ff9ff5ae/raw/535674db84a6809da89b8b3c3ade05a1e5772588/4.%2520Neekai%2520Nuthana "
    }
             
        
        
    ],
    newyear: [
        { name:"మన తండ్రి దేవుడే", file:"https://raw.githubusercontent.com/Rajatalluri91/World-of-God-Songs/main/Mana%20Thandri%20Devude.mp3", duration:"01:42", art:"https://raw.githubusercontent.com/Rajatalluri91/WOG-Images/refs/heads/main/Children%20Songs.jpg" },
        { name:"ఓ అన్న.. ఓ అక్క...", file:"https://raw.githubusercontent.com/Rajatalluri91/World-of-God-Songs/main/O%20Anna%20O%20Akka.mp3", duration:"01:49", art:"https://raw.githubusercontent.com/Rajatalluri91/WOG-Images/refs/heads/main/Children%20Songs.jpg" }
    ],
    sermons: [
        { name:"మెల్కీసెదెకు ఎవరు?", file:"https://raw.githubusercontent.com/Rajatalluri91/WOG-PODCAST-/main/Melchisedec.mp3", duration:"33:00", art:"https://raw.githubusercontent.com/Rajatalluri91/WOG-Images/refs/heads/main/Podcast%202.jpg" }
    ],
    classes: [
        
        { 
            name: "ఆరంభ శూరులు-ఆదివారపు క్రైస్తవులు", 
            file: "https://raw.githubusercontent.com/Rajatalluri91/WOG-AUDIOS/main/Arambha-Shoorulu-2026-02-24.mp3", 
            duration: "31:50", 
            art: "https://raw.githubusercontent.com/Rajatalluri91/WOG-Images/refs/heads/main/Bible%20Lessons.jpg" 
        },
        { 
            name: "కంటికి కనిపించని యుద్ధం..!", 
            file: "https://raw.githubusercontent.com/Rajatalluri91/WOG-AUDIOS/main/KANTIKI%20KANIPINCHANI%20YUDDHAM-2026-02-17-20-05-01-21.mp3", 
            duration: "34:08", 
            art: "https://raw.githubusercontent.com/Rajatalluri91/WOG-Images/refs/heads/main/Bible%20Lessons.jpg" 
        },
        { 
            name: "యేసుక్రీస్తు పుట్టినవాడా?", 
            file: "https://raw.githubusercontent.com/Rajatalluri91/WOG-AUDIOS/main/YESU%20KREESTHU%20PUTTINAVADA-2026-02-19-20-09-27-743.mp3", 
            duration: "22:41", 
            art: "https://raw.githubusercontent.com/Rajatalluri91/WOG-Images/refs/heads/main/Bible%20Lessons.jpg" 
        },
        { 
            name: "క్రైస్తవ్యంలో పురుషుని పాత్ర", 
            file: "https://raw.githubusercontent.com/Rajatalluri91/WOG-AUDIOS/main/KRAISTHAVYAM%20LO%20PURUSHUNI%20PATHRA-2026-02-05-20-07-44-750.mp3", 
            duration: "44:25", 
            art: "https://raw.githubusercontent.com/Rajatalluri91/WOG-Images/refs/heads/main/Bible%20Lessons.jpg" 
        },
		{ 
            name: "లోకాలు ఎన్ని?", 
            file: "https://raw.githubusercontent.com/Rajatalluri91/WOG-AUDIOS/main/LOKALU%20ENNI.mp3", 
            duration: "28:44", 
            art: "https://raw.githubusercontent.com/Rajatalluri91/WOG-Images/refs/heads/main/Bible%20Lessons.jpg" 
        },
        { 
            name: "మానవ మేధస్సుకు అందని కోడ్", 
            file: "https://raw.githubusercontent.com/Rajatalluri91/WOG-AUDIOS/main/DNA%20CODE.mp3", 
            duration: "34:18", 
            art: "https://raw.githubusercontent.com/Rajatalluri91/WOG-Images/refs/heads/main/Bible%20Lessons.jpg" 
        }
    ]

};

let activePlaylist = audioData.devotional;
let activeIndex = 0;
let currentPlaylistKey = 'devotional'; // ప్రస్తుతం UI లో ఉన్న ప్లేలిస్ట్ కీ
let parsedLyrics = [];
const audio = document.getElementById("myAudio");

function showSection(id, el) {
    document.querySelectorAll('.main-content').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    if(el) el.classList.add('active');
    
    if(id === 'home-sec') loadPlaylist('devotional');
    if(id === 'messages-sec') loadPlaylist('sermons');
}

function loadPlaylist(key) {
    currentPlaylistKey = key; // UI లో ఏ ప్లేలిస్ట్ ఉందో గుర్తుంచుకుంటుంది
    const listData = audioData[key];
    const activeSection = document.querySelector('.main-content.active');
    const listCtn = activeSection.querySelector('.playlist-ctn');
    if(!listCtn) return;

    listCtn.innerHTML = `<h3 style="color:var(--accent); font-size:14px; margin:20px 5px;">Play List</h3>`;
    listData.forEach((track, i) => {
        // హైలైట్ లాజిక్: డేటా మరియు ఇండెక్స్ రెండూ మ్యాచ్ కావాలి
        const isThisPlaying = (activePlaylist === listData && activeIndex === i);
        const div = document.createElement('div');
        div.className = `track-item ${isThisPlaying ? 'active-song' : ''}`;
        div.innerHTML = `<i class="fas fa-play-circle" style="color:var(--accent); font-size:20px; margin-right:15px;"></i>
                         <div><div>${track.name}</div><div style="font-size:11px; opacity:0.6">${track.duration}</div></div>`;
        div.onclick = (e) => { 
            e.stopPropagation(); 
            handleTrackClick(listData, i); 
        };
        listCtn.appendChild(div);
    });
}

function handleTrackClick(playlist, i) {
    if(activePlaylist === playlist && activeIndex === i && audio.src !== "") {
        toggleAudio();
    } else {
        playTrack(playlist, i);
    }
}

function playTrack(playlist, i) {
    if(playlist[i].file === "#") { alert("Audio not available"); return; }
    activePlaylist = playlist;
    activeIndex = i;
    const track = activePlaylist[activeIndex];
    audio.src = track.file;
    document.getElementById('mini-title').innerText = track.name;
    document.getElementById('exp-title').innerText = track.name;
    document.getElementById('miniArt').style.backgroundImage = `url(${track.art})`;
    document.getElementById('exp-art').style.backgroundImage = `url(${track.art})`;
    document.getElementById('totalTime').innerText = track.duration;
    
    parsedLyrics = [];
    document.getElementById('lyricsText').innerHTML = "";
    if(track.lrc) fetch(track.lrc).then(r => r.text()).then(t => { parsedLyrics = parseLRC(t); renderLyrics(); });

    updateHighlightUI();
    audio.play();
    updateIcons(true);
}

function toggleAudio(e) {
    if(e) e.stopPropagation();
    if(!audio.src || audio.src === window.location.href) { playTrack(activePlaylist, 0); return; }
    audio.paused ? (audio.play(), updateIcons(true)) : (audio.pause(), updateIcons(false));
}

function updateIcons(playing) {
    document.getElementById('m-play').style.display = playing ? 'none' : 'block';
    document.getElementById('m-pause').style.display = playing ? 'block' : 'none';
    document.getElementById('e-play').style.display = playing ? 'none' : 'block';
    document.getElementById('e-pause').style.display = playing ? 'block' : 'none';
}

function updateHighlightUI() {
    // ప్రస్తుతం UI లో ఏ సెక్షన్ ఉందో దాని ప్లేలిస్ట్‌ని రీలోడ్ చేస్తుంది
    loadPlaylist(currentPlaylistKey);
}

function parseLRC(lrc) {
    const lines = lrc.split('\n'), result = [], reg = /\[(\d{2}):(\d{2})\.(\d{2,3})\]/;
    lines.forEach(line => {
        const m = reg.exec(line);
        if(m) {
            const time = parseInt(m[1])*60 + parseInt(m[2]) + parseInt(m[3])/100;
            const text = line.replace(reg, '').trim();
            if(text) result.push({time, text});
        }
    });
    return result;
}

function renderLyrics() {
    document.getElementById('lyricsText').innerHTML = parsedLyrics.map((l, i) => `<p class="lyric-line" id="l-${i}">${l.text}</p>`).join('');
}

function toggleLyrics(e) { e.stopPropagation(); document.getElementById('artBox').classList.toggle('show-lyrics'); }
function handleMiniPlayerClick(e) { if(!document.getElementById('mainPlayer').classList.contains('expanded')) toggleAudio(e); }
function toggleExpand(e) { if(e) e.stopPropagation(); document.getElementById('mainPlayer').classList.add('expanded'); }
function closePlayer(e) { if(e) e.stopPropagation(); document.getElementById('mainPlayer').classList.remove('expanded'); }
function formatTime(s) { let m = Math.floor(s/60), sec = Math.floor(s%60); return (m<10?'0'+m:m)+':'+(sec<10?'0'+sec:sec); }
function seek(e) { e.stopPropagation(); const rect = document.getElementById('myProgress').getBoundingClientRect(); audio.currentTime = ((e.clientX - rect.left) / rect.width) * audio.duration; }
function changeSpeed(e) { e.stopPropagation(); const speeds = [1, 1.25, 1.5, 2, 0.5]; let nextIdx = (speeds.indexOf(audio.playbackRate) + 1) % speeds.length; audio.playbackRate = speeds[nextIdx]; document.getElementById('speedBtn').innerText = speeds[nextIdx] + 'x'; }
function downloadSong(e) { e.stopPropagation(); if(audio.src) { const a = document.createElement('a'); a.href = audio.src; a.download = document.getElementById('exp-title').innerText + ".mp3"; a.click(); } }

function next(e) { if(e) e.stopPropagation(); activeIndex = (activeIndex + 1) % activePlaylist.length; playTrack(activePlaylist, activeIndex); }
function previous(e) { if(e) e.stopPropagation(); activeIndex = (activeIndex - 1 + activePlaylist.length) % activePlaylist.length; playTrack(activePlaylist, activeIndex); }

audio.ontimeupdate = () => {
    if(!audio.duration) return;
    const cur = audio.currentTime;
    document.getElementById('myBar').style.width = (cur / audio.duration) * 100 + '%';
    document.getElementById('currTime').innerText = formatTime(cur);
    document.getElementById('mini-timer').innerText = formatTime(cur);
    parsedLyrics.forEach((l, i) => {
        if(cur >= l.time) {
            document.querySelectorAll('.lyric-line').forEach(el => el.classList.remove('active'));
            const active = document.getElementById(`l-${i}`);
            if(active) { active.classList.add('active'); active.scrollIntoView({ behavior: 'smooth', block: 'center' }); }
        }
    });
};

audio.onended = () => next();
loadPlaylist('devotional');

// --- Updated Back Press Logic (Working) ---

// 1. హిస్టరీ మేనేజ్మెంట్ కోసం చిన్న వేరియబుల్స్
let isPlaylistOpen = false;

// 2. లోడ్ ప్లేలిస్ట్ ఫంక్షన్‌ను అప్‌డేట్ చేస్తున్నాం (కార్డ్ క్లిక్ చేసినప్పుడు)
const originalLoadPlaylist = loadPlaylist;
loadPlaylist = function(key) {
    originalLoadPlaylist(key);
    isPlaylistOpen = true; // ప్లేలిస్ట్ ఓపెన్ అయిందని గుర్తుంచుకుంటుంది
    window.history.pushState({view: 'playlist'}, ""); // హిస్టరీలో ఒక స్టేట్ యాడ్ చేస్తుంది
};

// 3. సెక్షన్ మారినప్పుడు ప్లేలిస్ట్ స్టేట్ క్లియర్ చేయడం
const originalShowSection = showSection;
showSection = function(id, el) {
    originalShowSection(id, el);
    isPlaylistOpen = false;
    if(id !== 'home-sec') {
        window.history.pushState({view: 'section'}, "");
    }
};

// 4. బ్యాక్ బటన్ మెయిన్ లాజిక్
window.onpopstate = function(event) {
    const player = document.getElementById('mainPlayer');
    const activeSection = document.querySelector('.main-content.active');
    const playlistCtn = activeSection.querySelector('.playlist-ctn');

    // A. ప్లేయర్ పెద్దదిగా ఉంటే క్లోజ్ చేయాలి
    if (player.classList.contains('expanded')) {
        player.classList.remove('expanded');
        window.history.pushState(null, ""); 
        return;
    }

    // B. ప్లేలిస్ట్ (Card లిస్ట్) ఓపెన్ అయి ఉంటే దాన్ని క్లోజ్ చేయాలి
    if (isPlaylistOpen) {
        if (playlistCtn) playlistCtn.innerHTML = "";
        isPlaylistOpen = false;
        return; // ఇక్కడే ఆగిపోతుంది, హోమ్ కి వెళ్ళదు
    }

    // C. హోమ్ కాకుండా వేరే సెక్షన్ లో ఉంటే హోమ్ కి వెళ్ళాలి
    if (activeSection.id !== 'home-sec') {
        const homeNavItem = document.querySelector('.nav-item');
        showSection('home-sec', homeNavItem);
    } else {
        // హోమ్ లో ఉండి బ్యాక్ నొక్కితే బ్రౌజర్ బ్యాక్ లేదా ఎగ్జిట్
        history.back();
    }
};

// ఇనిషియల్ స్టేట్
window.history.replaceState({view: 'home'}, "");



// డాక్యుమెంట్ డేటా
const docData = {
    bibleDocs: [
        { name: "Bible Study Guide", url: "https://rajatalluri91.github.io/WOG-Documents/" },
        { name: "Old Testament Overview", url: "https://rajatalluri91.github.io/WOG-Documents/OT" }
    ],
    articles: [
        { name: "Creation vs Evolution", url: "https://rajatalluri91.github.io/WOG-Articles/" },
        { name: "Christian Life", url: "https://rajatalluri91.github.io/WOG-Articles/life" }
    ]
};

// డాక్యుమెంట్ లిస్ట్ లోడ్ చేసే ఫంక్షన్
function loadDocList(key) {
    const listData = docData[key];
    const listCtn = document.getElementById('docs-list-ctn');
    if(!listCtn) return;

    listCtn.innerHTML = `<h3 style="color:var(--accent); font-size:14px; margin:20px 5px;">Documents List</h3>`;
    
    listData.forEach((doc) => {
        const div = document.createElement('div');
        div.className = 'track-item'; // సాంగ్స్ లాగే స్టైల్ ఉండటానికి
        div.innerHTML = `
            <i class="fas fa-file-pdf" style="color:var(--accent); font-size:20px; margin-right:15px;"></i>
            <div><div>${doc.name}</div><div style="font-size:11px; opacity:0.6">Read Online</div></div>`;
        
        div.onclick = (e) => { 
            e.stopPropagation(); 
            window.location.href = doc.url; // ఐటమ్ క్లిక్ చేస్తే లింక్ ఓపెన్ అవుతుంది
        };
        listCtn.appendChild(div);
    });
    
    // బ్యాక్ ప్రెస్ కోసం స్టేట్ అప్‌డేట్ (పాత లాజిక్ ప్రకారం)
    if(typeof isPlaylistOpen !== 'undefined') isPlaylistOpen = true;
    window.history.pushState({view: 'doclist'}, "");
}

</script>
</body>
</html>
